/**
 * iOS-Specific CSS Overrides
 *
 * This stylesheet is ONLY loaded when running in iOS Capacitor app.
 * Provides iOS-specific fixes for safe areas, performance, and UX.
 *
 * IMPORTANT: This file is completely separate from web app styling.
 */

/* ================================
   PHASE 1: Safe Area Fixes
   ================================ */

:root {
  --ios-status-bar-height: env(safe-area-inset-top, 0px);
  --ios-home-indicator-height: env(safe-area-inset-bottom, 0px);
  --ios-safe-left: env(safe-area-inset-left, 0px);
  --ios-safe-right: env(safe-area-inset-right, 0px);
}

/* Fix header to respect notch/Dynamic Island */
header {
  padding-top: max(1rem, var(--ios-status-bar-height)) !important;
  height: calc(4rem + var(--ios-status-bar-height)) !important;
}

/* Fix main content spacing - account for header + safe areas */
main#main-content {
  /* Top: compensate for sticky header + notch */
  padding-top: calc(1rem + var(--ios-status-bar-height)) !important;

  /* Bottom: bottom nav height + home indicator + buffer */
  padding-bottom: calc(5rem + var(--ios-home-indicator-height) + 1rem) !important;
}

/* Bottom navigation - respect home indicator */
nav[aria-label="Primary"] {
  /* Add safe area padding to bottom */
  padding-bottom: var(--ios-home-indicator-height) !important;

  /* Adjust total height to include safe area */
  height: calc(5rem + var(--ios-home-indicator-height)) !important;
}

/* Footer spacing adjustment */
.mb-16.md\\:mb-0 {
  margin-bottom: calc(4rem + var(--ios-home-indicator-height)) !important;
}

/* ================================
   PHASE 2: Performance Optimizations
   ================================ */

/* Disable expensive backdrop-filter on iOS (causes jank) */
header {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(31, 41, 55, 0.95) !important;
}

/* Reduce animation complexity for better performance */
@media (prefers-reduced-motion: no-preference) {
  /* Simplify all animations */
  * {
    animation-duration: 150ms !important;
    transition-duration: 150ms !important;
  }

  /* Disable infinite animations (battery drain) */
  *[class*="animate-ping"],
  *[class*="animate-pulse"],
  *[class*="animate-spin"] {
    animation: none !important;
  }
}

/* Optimize scrolling performance */
main,
div[class*="overflow"],
.scroll-container {
  -webkit-overflow-scrolling: touch;
  overflow-scrolling: touch;
  will-change: scroll-position;
}

/* Reduce repaint on scroll */
header,
nav[aria-label="Primary"] {
  will-change: transform;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* ================================
   PHASE 3: Touch & UX Improvements
   ================================ */

/* Reduce bottom nav height for better space utilization */
nav[aria-label="Primary"] {
  height: calc(4rem + var(--ios-home-indicator-height)) !important; /* 64px instead of 80px */
}

nav[aria-label="Primary"] > div {
  height: 4rem !important; /* Match reduced height */
}

/* Optimize touch target sizes */
nav[aria-label="Primary"] .min-w-\\[72px\\] {
  min-width: 64px !important;
  padding: 0.625rem 0.75rem !important; /* 10px 12px */
}

/* Ensure minimum 44px touch targets (iOS HIG) */
nav[aria-label="Primary"] a,
nav[aria-label="Primary"] button {
  min-height: 44px !important;
  min-width: 44px !important;
}

/* Remove iOS tap highlights and callouts */
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Allow text selection in specific areas */
p, span, div[class*="text"], article {
  -webkit-user-select: text;
  user-select: text;
}

/* ================================
   PHASE 4: Viewport & Input Handling
   ================================ */

/* Prevent zoom on input focus */
input,
textarea,
select {
  font-size: 16px !important; /* iOS won't zoom if font-size >= 16px */
}

/* Disable phone number auto-linking */
a[href^="tel:"] {
  color: inherit;
  text-decoration: none;
  pointer-events: none;
}

/* ================================
   PHASE 5: AI Chat & Modal Improvements
   ================================ */

/* Keyboard-aware chat input positioning */
div[class*="chat"],
div[class*="ai-assistant"] {
  padding-bottom: max(1rem, var(--ios-home-indicator-height)) !important;
}

/* Chat bubble spacing for iOS */
div[class*="chat-bubble"] {
  margin: 0.75rem !important;
  max-width: 85% !important; /* More compact on smaller screens */
}

/* Input field at bottom of modals/chat */
input[type="text"]:last-of-type,
textarea:last-of-type {
  margin-bottom: calc(0.5rem + var(--ios-home-indicator-height)) !important;
}

/* ================================
   PHASE 6: Native iOS Polish
   ================================ */

/* Pull-to-refresh area (if implemented) */
.ptr-content {
  padding-top: var(--ios-status-bar-height);
}

/* Smooth momentum scrolling */
body {
  -webkit-overflow-scrolling: touch;
  overflow-scrolling: touch;
}

/* Card animations optimized for iOS */
div[class*="card"],
div[class*="glass"] {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Reduce shadow complexity for performance */
.shadow-lg,
.shadow-xl {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

/* ================================
   UTILITY: iOS-Specific Classes
   ================================ */

/* Apply these via conditional rendering */
.ios-only {
  display: block;
}

.web-only {
  display: none !important;
}

/* Safe area utilities */
.ios-safe-top {
  padding-top: var(--ios-status-bar-height);
}

.ios-safe-bottom {
  padding-bottom: var(--ios-home-indicator-height);
}

.ios-safe-left {
  padding-left: var(--ios-safe-left);
}

.ios-safe-right {
  padding-right: var(--ios-safe-right);
}

/* ================================
   DEBUG: Safe Area Visualization
   (Remove in production)
   ================================ */

/*
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--ios-status-bar-height);
  background: rgba(255, 0, 0, 0.2);
  z-index: 9999;
  pointer-events: none;
}

body::after {
  content: '';
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--ios-home-indicator-height);
  background: rgba(0, 255, 0, 0.2);
  z-index: 9999;
  pointer-events: none;
}
*/
