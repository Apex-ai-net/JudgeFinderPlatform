###############################################################################
# CourtListener API Integration Tests - REST Client Format
#
# Usage: Install REST Client extension in VS Code
# Set environment variables in .env or use VS Code REST Client settings
#
# Required Environment Variables:
# - COURTLISTENER_API_KEY: Your CourtListener API key
###############################################################################

@baseUrl = https://www.courtlistener.com/api/rest/v4
@apiKey = {{$dotenv COURTLISTENER_API_KEY}}
@testJudgeId = 12345
@testCourtId = ca
@contentType = application/json

###############################################################################
# 1. AUTHENTICATION TESTS
###############################################################################

### 1.1 Test Valid API Key Authentication
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 1.2 Test Invalid API Key (should return 401 or 403)
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token invalid-test-key-12345
User-Agent: JudgeFinder-API-Tests/1.0

### 1.3 Test Missing Authorization Header (should return 401 or 403)
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 2. JUDGE/PEOPLE ENDPOINTS
###############################################################################

### 2.1 List All Judges (Paginated)
# @name listJudges
GET {{baseUrl}}/people/?format=json&page_size=10&ordering=-date_modified HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.2 Get Specific Judge by ID
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.3 Filter Judges by State (California)
GET {{baseUrl}}/people/?format=json&positions__court__state=ca&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.4 Filter Judges by Federal Jurisdiction
GET {{baseUrl}}/people/?format=json&positions__court__jurisdiction=F&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.5 Search Judges by Name
GET {{baseUrl}}/people/?format=json&name=Smith&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.6 Test 404 on Non-Existent Judge
GET {{baseUrl}}/people/999999999/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 2.7 Get Judge with Field Selection (Optimization Test)
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json&fields=id,name,positions HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 3. OPINION ENDPOINTS
###############################################################################

### 3.1 Search Opinions by Author (Judge ID)
# @name searchOpinions
GET {{baseUrl}}/opinions/?format=json&author={{testJudgeId}}&page_size=10&ordering=-date_created HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 3.2 Get Specific Opinion by ID
@opinionId = 12345
GET {{baseUrl}}/opinions/{{opinionId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 3.3 Filter Opinions by Date Range
GET {{baseUrl}}/opinions/?format=json&cluster__date_filed__gte=2023-01-01&cluster__date_filed__lte=2023-12-31&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 3.4 Get Recent Opinions (Last 30 Days)
@thirtyDaysAgo = {{$datetime rfc1123 -30 d}}
GET {{baseUrl}}/opinions/?format=json&cluster__date_filed__gte=2024-09-01&page_size=20&ordering=-date_created HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 3.5 Search Opinions by Case Name
GET {{baseUrl}}/opinions/?format=json&case_name=Smith&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 4. CLUSTER ENDPOINTS
###############################################################################

### 4.1 Get Cluster Details
@clusterId = 123456
GET {{baseUrl}}/clusters/{{clusterId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 4.2 List Recent Clusters
GET {{baseUrl}}/clusters/?format=json&date_filed__gte=2024-01-01&page_size=10&ordering=-date_filed HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 4.3 Filter Clusters by Precedential Status
GET {{baseUrl}}/clusters/?format=json&precedential_status=Published&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 5. DOCKET ENDPOINTS
###############################################################################

### 5.1 Search Dockets by Assigned Judge
GET {{baseUrl}}/dockets/?format=json&assigned_to_id={{testJudgeId}}&page_size=10&ordering=-date_filed HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 5.2 Get Specific Docket by ID
@docketId = 123456
GET {{baseUrl}}/dockets/{{docketId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 5.3 Filter Dockets by Court
GET {{baseUrl}}/dockets/?format=json&court=cand&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 5.4 Filter Dockets by Date Range
GET {{baseUrl}}/dockets/?format=json&date_filed__gte=2024-01-01&date_filed__lte=2024-12-31&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 5.5 Search Dockets by Nature of Suit
GET {{baseUrl}}/dockets/?format=json&nature_of_suit=Civil Rights&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 6. COURT ENDPOINTS
###############################################################################

### 6.1 List All Courts
GET {{baseUrl}}/courts/?format=json&page_size=20 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 6.2 Get Specific Court by ID
GET {{baseUrl}}/courts/{{testCourtId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 6.3 Filter Courts by Jurisdiction
GET {{baseUrl}}/courts/?format=json&jurisdiction=F&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 6.4 Filter Courts by State
GET {{baseUrl}}/courts/?format=json&jurisdiction=State&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 6.5 Search Courts in Use
GET {{baseUrl}}/courts/?format=json&in_use=true&page_size=20 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 7. PAGINATION TESTS
###############################################################################

### 7.1 Test Page Size Limits
GET {{baseUrl}}/people/?format=json&page_size=100 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 7.2 Test Offset Pagination
GET {{baseUrl}}/people/?format=json&page_size=10&offset=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 7.3 Test Cursor-Based Pagination (Following Next URL)
# Note: Use the 'next' URL from previous response
GET {{baseUrl}}/people/?format=json&page_size=5 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 8. RATE LIMITING TESTS
###############################################################################

### 8.1 Check Rate Limit Headers in Response
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Note: Check response headers for:
# - X-RateLimit-Limit: Maximum requests per hour
# - X-RateLimit-Remaining: Remaining requests in current window
# - X-RateLimit-Reset: Unix timestamp when limit resets

### 8.2 Test Rate Limit with Rapid Requests
# WARNING: This may temporarily exhaust your rate limit
# @name rapidRequest1
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### @name rapidRequest2
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### @name rapidRequest3
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 9. ERROR HANDLING TESTS
###############################################################################

### 9.1 Test Invalid Endpoint (404)
GET {{baseUrl}}/invalid-endpoint/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 9.2 Test Invalid Query Parameter (400)
GET {{baseUrl}}/opinions/?format=json&invalid_filter=test HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 9.3 Test Invalid Date Format (400)
GET {{baseUrl}}/opinions/?format=json&cluster__date_filed__gte=not-a-date HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 9.4 Test Invalid Ordering Field
GET {{baseUrl}}/people/?format=json&ordering=invalid_field HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 10. CONDITIONAL REQUESTS (CACHING)
###############################################################################

### 10.1 First Request (Get ETag)
# @name firstRequest
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Note: Extract ETag from response headers

### 10.2 Conditional Request with If-None-Match
# Replace <ETAG_VALUE> with actual ETag from previous response
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0
If-None-Match: "<ETAG_VALUE>"

###
# Expected: 304 Not Modified if content hasn't changed

###############################################################################
# 11. PERFORMANCE OPTIMIZATION TESTS
###############################################################################

### 11.1 Request with Field Selection (Reduce Payload Size)
GET {{baseUrl}}/people/?format=json&page_size=10&fields=id,name,positions HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 11.2 Request with Minimal Fields
GET {{baseUrl}}/opinions/?format=json&author={{testJudgeId}}&page_size=10&fields=id,cluster,date_filed HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 11.3 Compressed Response (Accept-Encoding)
GET {{baseUrl}}/people/?format=json&page_size=50 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0
Accept-Encoding: gzip, deflate, br

###############################################################################
# 12. COMPLEX QUERY TESTS
###############################################################################

### 12.1 Multi-Filter Query
GET {{baseUrl}}/opinions/?format=json&author={{testJudgeId}}&cluster__date_filed__gte=2023-01-01&cluster__precedential_status=Published&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 12.2 Nested Field Filtering
GET {{baseUrl}}/people/?format=json&positions__court__jurisdiction=F&positions__date_termination__isnull=true&page_size=10 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

### 12.3 Combined Ordering and Filtering
GET {{baseUrl}}/dockets/?format=json&assigned_to_id={{testJudgeId}}&date_filed__gte=2024-01-01&ordering=-date_last_filing&page_size=20 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 13. DATA VALIDATION TESTS
###############################################################################

### 13.1 Verify Opinion Has Required Fields
GET {{baseUrl}}/opinions/{{opinionId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Expected fields: id, cluster, plain_text, html, html_with_citations, date_created, date_modified

### 13.2 Verify Judge Has Positions Array
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Expected: positions array with court assignment history

### 13.3 Verify Cluster Has Case Metadata
GET {{baseUrl}}/clusters/{{clusterId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Expected: case_name, date_filed, precedential_status, citation_count

###############################################################################
# 14. API VERSION CHECKS
###############################################################################

### 14.1 Check API Version in Response
GET {{baseUrl}}/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Note: Verify response is from v4 API (check URL structure)

### 14.2 Test v3 API (Should be deprecated or redirect to v4)
GET https://www.courtlistener.com/api/rest/v3/people/?format=json&page_size=1 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# 15. INTEGRATION SMOKE TESTS
###############################################################################

### 15.1 Full Judge Profile Workflow
# Step 1: Get judge list
GET {{baseUrl}}/people/?format=json&page_size=1&ordering=-date_modified HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Step 2: Get judge details (use ID from step 1)
GET {{baseUrl}}/people/{{testJudgeId}}/?format=json HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Step 3: Get judge's opinions
GET {{baseUrl}}/opinions/?format=json&author={{testJudgeId}}&page_size=5 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###
# Step 4: Get judge's dockets
GET {{baseUrl}}/dockets/?format=json&assigned_to_id={{testJudgeId}}&page_size=5 HTTP/1.1
Authorization: Token {{apiKey}}
User-Agent: JudgeFinder-API-Tests/1.0

###############################################################################
# END OF TESTS
###############################################################################
