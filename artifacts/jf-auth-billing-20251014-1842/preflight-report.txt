========================================
JudgeFinder Auth + Billing Audit/Fix
Preflight Report
========================================
Generated: $(date -u +"%Y-%m-%d %H:%M:%S UTC")
Working Directory: /Users/tannerosterkamp/JudgeFinder/JudgeFinderPlatform

========================================
Key Dependencies (package.json)
========================================
@clerk/nextjs: ^6.31.3
stripe: ^14.0.0
@supabase/supabase-js: ^2.39.0
@supabase/ssr: ^0.6.1
next: ^15.5.3
typescript: 5.9.3

========================================
Environment Variables (from .env.example)
========================================
[REQUIRED] Clerk:
- NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY (must start with pk_)
- CLERK_SECRET_KEY (must start with sk_)

[REQUIRED] Stripe:
- STRIPE_SECRET_KEY (sk_test_ for test, sk_live_ for prod)
- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
- STRIPE_WEBHOOK_SECRET (whsec_...)
- STRIPE_PRICE_MONTHLY (price_...)
- STRIPE_PRICE_YEARLY (price_...)

[REQUIRED] Supabase:
- NEXT_PUBLIC_SUPABASE_URL
- NEXT_PUBLIC_SUPABASE_ANON_KEY
- SUPABASE_SERVICE_ROLE_KEY
- SUPABASE_JWT_SECRET

========================================
MCP Servers Available
========================================
The following MCP servers will be used:
✓ Puppeteer MCP - browser automation
✓ Clerk MCP - auth config verification
✓ Stripe MCP - test mode checkout/webhooks
✓ Supabase MCP - schema queries and RLS testing
✓ GitHub MCP - commits and PR creation
✓ Netlify MCP - deploy monitoring

========================================
Current State Assessment
========================================
CRITICAL FINDINGS:
❌ /ads/buy page NOT protected (publicly accessible)
❌ /api/checkout/adspace NOT protected (no auth check)
❌ No Clerk user_id linkage in ad_orders table
❌ Webhook doesn't save created_by field
❌ Missing /dashboard/billing page

WORKING:
✓ Middleware protects /dashboard/*, /profile/*, /settings/*
✓ Stripe webhook handler exists at /api/stripe/webhook
✓ Supabase ad_orders table exists with RLS enabled
✓ Universal pricing configured ($500/mo, $5,000/yr)

========================================
Execution Plan
========================================
Phase 1: ✓ Preflight complete
Phase 2: Puppeteer auth crawl
Phase 3: Clerk config audit
Phase 4: Route protection implementation
Phase 5: Webhook & Supabase integration
Phase 6: Stripe test flow
Phase 7: Dashboard billing page
Phase 8: E2E test
Phase 9: Deployment
Phase 10: Production verification

========================================
Next Steps
========================================
1. Run Puppeteer audit on https://judgefinder.io/sign-in
2. Verify Clerk configuration via MCP
3. Implement auth gates in middleware and API routes
